<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Async Utilities - @rageltd/bun-test-utils</title>
    <meta name="description" content="Async utilities for handling asynchronous operations in Bun tests.">
    <link rel="stylesheet" href="css/gitbook.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
</head>
<body>
    <button class="mobile-toggle">☰</button>

    <div class="gitbook-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title"><a href="https://github.com/rageltd/bun-test-utils" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">@rageltd/bun-test-utils</a></h1>
                <p class="sidebar-subtitle">Test utilities for Bun projects</p>
            </div>

            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search documentation...">
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <ul class="nav-subsection">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">Introduction</a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h3 class="nav-section-title">Getting Started</h3>
                    <ul class="nav-subsection">
                        <li class="nav-item">
                            <a href="installation.html" class="nav-link">Installation</a>
                        </li>
                        <li class="nav-item">
                            <a href="quick-start.html" class="nav-link">Quick Start</a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h3 class="nav-section-title">API Reference</h3>
                    <ul class="nav-subsection">
                        <li class="nav-item">
                            <a href="async-utilities.html" class="nav-link active">Async Utilities</a>
                        </li>
                        <li class="nav-item">
                            <a href="mock-utilities.html" class="nav-link">Mock Utilities</a>
                        </li>
                        <li class="nav-item">
                            <a href="hook-mocking.html" class="nav-link">Hook Mocking</a>
                        </li>
                        <li class="nav-item">
                            <a href="component-mocking.html" class="nav-link">Component Mocking</a>
                        </li>
                        <li class="nav-item">
                            <a href="graphql-mocking.html" class="nav-link">GraphQL Mocking</a>
                        </li>
                        <li class="nav-item">
                            <a href="module-mocking.html" class="nav-link">Module Mocking</a>
                        </li>
                        <li class="nav-item">
                            <a href="partial-mocks.html" class="nav-link">Partial Mocks</a>
                        </li>
                        <li class="nav-item">
                            <a href="spy-utilities.html" class="nav-link">Spy Utilities</a>
                        </li>
                        <li class="nav-item">
                            <a href="cleanup-utilities.html" class="nav-link">Cleanup Utilities</a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h3 class="nav-section-title">Guides</h3>
                    <ul class="nav-subsection">
                        <li class="nav-item">
                            <a href="testing-patterns.html" class="nav-link">Testing Patterns</a>
                        </li>
                        <li class="nav-item">
                            <a href="working-with-bun.html" class="nav-link">Working with Bun</a>
                        </li>
                        <li class="nav-item">
                            <a href="common-issues.html" class="nav-link">Common Issues</a>
                        </li>
                        <li class="nav-item">
                            <a href="migration-guide.html" class="nav-link">Migration Guide</a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h3 class="nav-section-title">Examples</h3>
                    <ul class="nav-subsection">
                        <li class="nav-item">
                            <a href="basic-testing.html" class="nav-link">Basic Testing</a>
                        </li>
                        <li class="nav-item">
                            <a href="react-components.html" class="nav-link">React Components</a>
                        </li>
                        <li class="nav-item">
                            <a href="graphql-testing.html" class="nav-link">GraphQL Testing</a>
                        </li>
                        <li class="nav-item">
                            <a href="module-mocking-examples.html" class="nav-link">Module Mocking</a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h3 class="nav-section-title">Contributing</h3>
                    <ul class="nav-subsection">
                        <li class="nav-item">
                            <a href="development-setup.html" class="nav-link">Development Setup</a>
                        </li>
                        <li class="nav-item">
                            <a href="semantic-commits.html" class="nav-link">Semantic Commits</a>
                        </li>
                        <li class="nav-item">
                            <a href="release-process.html" class="nav-link">Release Process</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="content-wrapper">
                <h1 id="async-utilities">Async Utilities</h1>

                <p>The async utilities module provides tools for handling asynchronous operations in tests, making it easier to work with timing-dependent code and async workflows.</p>

                <h2 id="waitfor">waitFor</h2>

                <h3 id="signature">Signature</h3>

                <pre><code class="language-typescript">function waitFor(ms?: number): Promise&lt;void&gt;</code></pre>

                <h3 id="description">Description</h3>

                <p>A utility function that creates a promise that resolves after a specified number of milliseconds. This is particularly useful for:</p>

                <ul>
                    <li>Waiting for async operations to complete</li>
                    <li>Simulating delays in tests</li>
                    <li>Allowing React components to update</li>
                    <li>Testing timing-dependent behavior</li>
                </ul>

                <h3 id="parameters">Parameters</h3>

                <table></table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                        <tr>
                            <td><code>ms</code></td>
                            <td><code>number</code></td>
                            <td><code>0</code></td>
                            <td>Number of milliseconds to wait</td>
                        </tr>
                    </tbody>
                </table>

                <h3 id="returns">Returns</h3>

                <p><code>Promise&lt;void&gt;</code> - A promise that resolves after the specified time</p>

                <h3 id="examples">Examples</h3>

                <h4 id="basic-usage">Basic Usage</h4>

                <pre><code class="language-typescript">import { waitFor } from '@rageltd/bun-test-utils';
import { test, expect } from 'bun:test';

test('waits for async operations', async () => {
  const start = Date.now();

  await waitFor(100);

  const elapsed = Date.now() - start;
  expect(elapsed).toBeGreaterThanOrEqual(100);
});</code></pre>

                <h4 id="testing-async-components">Testing Async Components</h4>

                <pre><code class="language-typescript">import { render, screen } from '@testing-library/react';
import { waitFor } from '@rageltd/bun-test-utils';

test('waits for component to update', async () => {
  render(&lt;AsyncComponent /&gt;);

  // Wait for component to finish loading
  await waitFor(100);

  expect(screen.getByText('Loaded!')).toBeInTheDocument();
});</code></pre>

                <h4 id="next-tick-default-behavior">Next Tick (Default Behavior)</h4>

                <pre><code class="language-typescript">import { waitFor } from '@rageltd/bun-test-utils';

test('waits for next tick', async () => {
  let updated = false;

  // Schedule something for next tick
  setTimeout(() => { updated = true; }, 0);

  // Wait for next tick (default 0ms)
  await waitFor();

  expect(updated).toBe(true);
});</code></pre>

                <h4 id="testing-debounced-functions">Testing Debounced Functions</h4>

                <pre><code class="language-typescript">import { waitFor } from '@rageltd/bun-test-utils';

test('tests debounced function', async () => {
  const mockFn = createMock();
  const debouncedFn = debounce(mockFn, 50);

  // Call multiple times
  debouncedFn('first');
  debouncedFn('second');
  debouncedFn('third');

  // Wait for debounce period
  await waitFor(60);

  // Should only be called once with the last value
  expect(mockFn).toHaveBeenCalledTimes(1);
  expect(mockFn).toHaveBeenCalledWith('third');
});</code></pre>

                <h4 id="testing-animation-timings">Testing Animation Timings</h4>

                <pre><code class="language-typescript">import { waitFor } from '@rageltd/bun-test-utils';

test('tests animation completion', async () => {
  const element = document.createElement('div');
  element.style.transition = 'opacity 200ms';
  element.style.opacity = '0';

  document.body.appendChild(element);

  // Trigger animation
  element.style.opacity = '1';

  // Wait for animation to complete
  await waitFor(250);

  expect(getComputedStyle(element).opacity).toBe('1');
});</code></pre>

                <h2 id="best-practices">Best Practices</h2>

                <h3 id="use-minimal-wait-times">1. Use Minimal Wait Times</h3>

                <p>Only wait as long as necessary to avoid slow tests:</p>

                <div class="callout callout-error">
                    <pre><code class="language-typescript">// ❌ Avoid unnecessarily long waits
await waitFor(5000);</code></pre>
                </div>

                <div class="callout callout-success">
                    <pre><code class="language-typescript">// ✅ Use minimal required time
await waitFor(100);</code></pre>
                </div>

                <h3 id="combine-with-testing-library-utilities">2. Combine with Testing Library Utilities</h3>

                <p>For React testing, prefer <code>@testing-library/react</code>'s async utilities when possible:</p>

                <pre><code class="language-typescript">import { waitFor as waitForElement } from '@testing-library/react';
import { waitFor } from '@rageltd/bun-test-utils';

// ✅ For DOM changes, use testing-library
await waitForElement(() => screen.getByText('Loaded'));

// ✅ For timing/delays, use bun-test-utils
await waitFor(100);</code></pre>

                <h3 id="document-wait-reasons">3. Document Wait Reasons</h3>

                <p>Add comments explaining why you're waiting:</p>

                <pre><code class="language-typescript">// Wait for debounce period to complete
await waitFor(300);

// Allow React to flush state updates
await waitFor();</code></pre>

                <h3 id="consider-alternatives">4. Consider Alternatives</h3>

                <p>Before using <code>waitFor</code>, consider if there are better alternatives:</p>

                <div class="callout callout-warning">
                    <pre><code class="language-typescript">// ❌ Waiting for arbitrary time
await waitFor(1000);
expect(element).toHaveClass('loaded');</code></pre>
                </div>

                <div class="callout callout-success">
                    <pre><code class="language-typescript">// ✅ Waiting for specific condition
await waitForElement(() =>
  expect(element).toHaveClass('loaded')
);</code></pre>
                </div>

                <h2 id="common-use-cases">Common Use Cases</h2>

                <h3 id="testing-async-state-updates">Testing Async State Updates</h3>

                <pre><code class="language-typescript">test('handles async state updates', async () => {
  const { result } = renderHook(() => useAsyncData());

  act(() => {
    result.current.fetch();
  });

  // Wait for async operation
  await waitFor(100);

  expect(result.current.data).toBeDefined();
});</code></pre>

                <h3 id="testing-timers-and-intervals">Testing Timers and Intervals</h3>

                <pre><code class="language-typescript">test('tests interval behavior', async () => {
  const mockCallback = createMock();

  const intervalId = setInterval(mockCallback, 100);

  // Wait for multiple intervals
  await waitFor(350);

  clearInterval(intervalId);

  expect(mockCallback).toHaveBeenCalledTimes(3);
});</code></pre>

                <h3 id="testing-promise-chains">Testing Promise Chains</h3>

                <pre><code class="language-typescript">test('waits for promise chain completion', async () => {
  const result = await Promise.resolve('initial')
    .then(value => {
      return new Promise(resolve => {
        setTimeout(() => resolve(`${value}-processed`), 50);
      });
    });

  // Additional wait if needed
  await waitFor(10);

  expect(result).toBe('initial-processed');
});</code></pre>

                <div class="page-navigation">
                    <a href="installation.html" class="nav-prev">Installation</a>
                    <a href="mock-utilities.html" class="nav-next">Mock Utilities</a>
                </div>

                <h2 id="see-also">See Also</h2>

                <ul>
                    <li><a href="testing-patterns.html">Testing Patterns</a> - Learn about async testing patterns</li>
                    <li><a href="common-issues.html">Common Issues</a> - Troubleshooting async tests</li>
                    <li><a href="mock-utilities.html">Mock Utilities</a> - Creating mocks for async functions</li>
                </ul>
            </div>
        </main>
    </div>

    <script src="js/gitbook.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>
