<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GraphQL Mocking - @rageltd/bun-test-utils</title>
    <meta
      name="description"
      content="GraphQL Mocking documentation for @rageltd/bun-test-utils"
    />
    <link rel="stylesheet" href="css/gitbook.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  </head>
  <body>
    <button class="mobile-toggle">☰</button>

    <div class="gitbook-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <h1 class="sidebar-title">@rageltd/bun-test-utils</h1>
          <p class="sidebar-subtitle">Test utilities for Bun projects</p>
        </div>

        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="Search documentation..."
          />
        </div>

        <nav class="nav-menu">
          <div class="nav-section">
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="index.html" class="nav-link">Introduction</a>
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Getting Started</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="installation.html" class="nav-link">Installation</a>
              </li>
              <li class="nav-item">
                <a href="quick-start.html" class="nav-link">Quick Start</a>
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">API Reference</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="async-utilities.html" class="nav-link"
                  >Async Utilities</a
                >
              </li>
              <li class="nav-item">
                <a href="mock-utilities.html" class="nav-link"
                  >Mock Utilities</a
                >
              </li>
              <li class="nav-item">
                <a href="hook-mocking.html" class="nav-link">Hook Mocking</a>
              </li>
              <li class="nav-item">
                <a href="component-mocking.html" class="nav-link"
                  >Component Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="graphql-mocking.html" class="nav-link active"
                  >GraphQL Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="module-mocking.html" class="nav-link"
                  >Module Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="partial-mocks.html" class="nav-link">Partial Mocks</a>
              </li>
              <li class="nav-item">
                <a href="spy-utilities.html" class="nav-link">Spy Utilities</a>
              </li>
              <li class="nav-item">
                <a href="cleanup-utilities.html" class="nav-link"
                  >Cleanup Utilities</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Guides</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="testing-patterns.html" class="nav-link"
                  >Testing Patterns</a
                >
              </li>
              <li class="nav-item">
                <a href="working-with-bun.html" class="nav-link"
                  >Working with Bun</a
                >
              </li>
              <li class="nav-item">
                <a href="common-issues.html" class="nav-link">Common Issues</a>
              </li>
              <li class="nav-item">
                <a href="migration-guide.html" class="nav-link"
                  >Migration Guide</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Examples</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="basic-testing.html" class="nav-link">Basic Testing</a>
              </li>
              <li class="nav-item">
                <a href="react-components.html" class="nav-link"
                  >React Components</a
                >
              </li>
              <li class="nav-item">
                <a href="graphql-testing.html" class="nav-link"
                  >GraphQL Testing</a
                >
              </li>
              <li class="nav-item">
                <a href="module-mocking-examples.html" class="nav-link"
                  >Module Mocking</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Contributing</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="development-setup.html" class="nav-link"
                  >Development Setup</a
                >
              </li>
              <li class="nav-item">
                <a href="semantic-commits.html" class="nav-link"
                  >Semantic Commits</a
                >
              </li>
              <li class="nav-item">
                <a href="release-process.html" class="nav-link"
                  >Release Process</a
                >
              </li>
            </ul>
          </div>
        </nav>
      </aside>

      <main class="main-content">
        <div class="content-wrapper">
          <h1>GraphQL Mocking</h1>

          <p></p>
            The GraphQL mocking module provides utilities for mocking GraphQL
            operations in your tests, including queries, mutations, lazy
            queries, and error states. This makes it easy to test React
            components that depend on GraphQL data.
          </p>

          <h2 id="createmockgraphqlhook">createMockGraphQLHook</h2>

          <h3 id="signature">Signature</h3>

          <pre><code class="language-typescript">function createMockGraphQLHook(
  operationName: string,
  mockData?: unknown,
  loading?: boolean,
  error?: Error | null
): any</code></pre>

          <h3 id="description">Description</h3>

          <p>
            Creates a mock GraphQL hook that mimics the behavior of Apollo
            Client hooks like <code>useQuery</code>, <code>useMutation</code>,
            and <code>useLazyQuery</code>. The function automatically detects
            lazy queries based on the operation name and returns appropriate
            results.
          </p>

          <h3 id="parameters">Parameters</h3>

          <table>
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Default</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>operationName</code></td>
                <td><code>string</code></td>
                <td>-</td>
                <td>Name of the GraphQL operation</td>
              </tr>
              <tr>
                <td><code>mockData</code></td>
                <td><code>unknown</code></td>
                <td><code>null</code></td>
                <td>Mock data to return</td>
              </tr>
              <tr>
                <td><code>loading</code></td>
                <td><code>boolean</code></td>
                <td><code>false</code></td>
                <td>Whether the operation is loading</td>
              </tr>
              <tr>
                <td><code>error</code></td>
                <td><code>Error | null</code></td>
                <td><code>null</code></td>
                <td>Error to return (if any)</td>
              </tr>
            </tbody>
          </table>

          <h3 id="returns">Returns</h3>

          <p>
            For regular queries and mutations: An object with
            <code>data</code>, <code>loading</code>, <code>error</code>, and
            other Apollo Client properties.
          </p>

          <p>
            For lazy queries (operations containing "Lazy"): A tuple
            <code>[executeFunction, resultObject]</code>.
          </p>

          <h3 id="examples">Examples</h3>

          <h4 id="mocking-queries">Mocking Queries</h4>

          <pre><code class="language-typescript">import { createMockGraphQLHook, createModuleMocker } from '@rageltd/bun-test-utils';
import { test, expect, beforeEach, afterAll } from 'bun:test';

const mockModules = createModuleMocker();

test('mocks a GraphQL query', async () => {
  const mockUserData = {
    id: '1',
    name: 'John Doe',
    email: 'john@example.com'
  };

  await mockModules.mock('@apollo/client', () => ({
    useQuery: createMockGraphQLHook('GetUser', mockUserData, false, null)
  }));

  const { useQuery } = await import('@apollo/client');
  const result = useQuery();

  expect(result.data).toEqual(mockUserData);
  expect(result.loading).toBe(false);
  expect(result.error).toBeNull();
});</code></pre>

          <h4 id="mocking-loading-states">Mocking Loading States</h4>

          <pre><code class="language-typescript">import { render, screen } from '@testing-library/react';
import { createMockGraphQLHook } from '@rageltd/bun-test-utils';

describe('UserProfile component', () => {
  test('shows loading state', async () => {
    await mockModules.mock('@apollo/client', () => ({
      useQuery: createMockGraphQLHook('GetUser', null, true, null)
    }));

    const { UserProfile } = await import('@/components/UserProfile');
    render(<UserProfile userId="1" />);

    expect(screen.getByText('Loading...')).toBeInTheDocument();
  });
});</code></pre>

          <h4 id="mocking-error-states">Mocking Error States</h4>

          <pre><code class="language-typescript">import { createMockGraphQLHook } from '@rageltd/bun-test-utils';

test('handles GraphQL errors', async () => {
  const mockError = new Error('User not found');

  await mockModules.mock('@apollo/client', () => ({
    useQuery: createMockGraphQLHook('GetUser', null, false, mockError)
  }));

  const { UserProfile } = await import('@/components/UserProfile');
  render(<UserProfile userId="999" />);

  expect(screen.getByText('User not found')).toBeInTheDocument();
});</code></pre>

          <h4 id="mocking-mutations">Mocking Mutations</h4>

          <pre><code class="language-typescript">import { fireEvent } from '@testing-library/react';
import { createMockGraphQLHook } from '@rageltd/bun-test-utils';

test('mocks a GraphQL mutation', async () => {
  const mockMutationResult = {
    id: '1',
    name: 'Updated Name'
  };

  await mockModules.mock('@apollo/client', () => ({
    useMutation: createMockGraphQLHook('UpdateUser', mockMutationResult)
  }));

  const { UpdateUserForm } = await import('@/components/UpdateUserForm');
  render(<UpdateUserForm userId="1" />);

  const submitButton = screen.getByRole('button', { name: 'Update' });
  fireEvent.click(submitButton);

  expect(screen.getByText('User updated successfully')).toBeInTheDocument();
});</code></pre>

          <h4 id="mocking-lazy-queries">Mocking Lazy Queries</h4>

          <pre><code class="language-typescript">import { createMockGraphQLHook, createMock } from '@rageltd/bun-test-utils';

test('mocks a lazy query', async () => {
  const mockData = { users: [{ id: '1', name: 'John' }] };
  const mockLazyQuery = createMockGraphQLHook('SearchUsersLazy', mockData);

  await mockModules.mock('@apollo/client', () => ({
    useLazyQuery: () => mockLazyQuery
  }));

  const { SearchComponent } = await import('@/components/SearchComponent');
  render(<SearchComponent />);

  // mockLazyQuery is a tuple: [executeFunction, result]
  const [executeSearch, result] = mockLazyQuery;

  // Simulate executing the search
  executeSearch({ variables: { query: 'john' } });

  expect(result.data).toEqual(mockData);
});</code></pre>

          <h4 id="testing-refetch-functionality">Testing Refetch Functionality</h4>

          <pre><code class="language-typescript">import { createMockGraphQLHook } from '@rageltd/bun-test-utils';

test('tests refetch functionality', async () => {
  const initialData = { user: { id: '1', name: 'John' } };
  const refetchedData = { user: { id: '1', name: 'John Updated' } };

  const mockQuery = createMockGraphQLHook('GetUser', initialData);

  await mockModules.mock('@apollo/client', () => ({
    useQuery: () => mockQuery
  }));

  const { UserProfile } = await import('@/components/UserProfile');
  render(<UserProfile userId="1" />);

  // Test initial data
  expect(screen.getByText('John')).toBeInTheDocument();

  // Mock refetch returning new data
  mockQuery.refetch.mockResolvedValue({ data: refetchedData });

  const refetchButton = screen.getByRole('button', { name: 'Refresh' });
  fireEvent.click(refetchButton);

  expect(mockQuery.refetch).toHaveBeenCalled();
});</code></pre>

          <h2 id="common-patterns">Common Patterns</h2>

          <h3 id="testing-different-data-states">Testing Different Data States</h3>

          <pre><code class="language-typescript">describe('ProductList component', () => {
  afterAll(() => {
    mockModules.restoreAll();
  });

  test.each([
    {
      state: 'loading',
      mockProps: { data: null, loading: true, error: null },
      expected: 'Loading products...'
    },
    {
      state: 'empty',
      mockProps: { data: { products: [] }, loading: false, error: null },
      expected: 'No products found'
    },
    {
      state: 'with data',
      mockProps: {
        data: { products: [{ id: '1', name: 'Product 1' }] },
        loading: false,
        error: null
      },
      expected: 'Product 1'
    },
    {
      state: 'error',
      mockProps: { data: null, loading: false, error: new Error('Failed to load') },
      expected: 'Failed to load'
    }
  ])('renders correctly in $state state', async ({ mockProps, expected }) => {
    await mockModules.mock('@apollo/client', () => ({
      useQuery: createMockGraphQLHook('GetProducts', mockProps.data, mockProps.loading, mockProps.error)
    }));

    const { ProductList } = await import('@/components/ProductList');
    render(<ProductList />);

    expect(screen.getByText(expected)).toBeInTheDocument();
  });
});</code></pre>

          <h3 id="mocking-multiple-operations">Mocking Multiple Operations</h3>

          <pre><code class="language-typescript">describe('Dashboard component', () => {
  beforeEach(async () => {
    await mockModules.mock('@apollo/client', () => ({
      useQuery: (operation) => {
        switch (operation.definitions[0].name.value) {
          case 'GetUser':
            return createMockGraphQLHook('GetUser', { user: { id: '1', name: 'John' } });
          case 'GetStats':
            return createMockGraphQLHook('GetStats', { stats: { views: 100, likes: 50 } });
          default:
            return createMockGraphQLHook('Unknown', null, false, new Error('Unknown operation'));
        }
      }
    }));
  });

  test('renders user info and stats', async () => {
    const { Dashboard } = await import('@/components/Dashboard');
    render(<Dashboard />);

    expect(screen.getByText('John')).toBeInTheDocument();
    expect(screen.getByText('Views: 100')).toBeInTheDocument();
    expect(screen.getByText('Likes: 50')).toBeInTheDocument();
  });
});</code></pre>

          <h3 id="testing-optimistic-updates">Testing Optimistic Updates</h3>

          <pre><code class="language-typescript">test('handles optimistic updates', async () => {
  const mockMutation = createMockGraphQLHook('UpdatePost', {
    post: { id: '1', title: 'Updated Title', likes: 11 }
  });

  await mockModules.mock('@apollo/client', () => ({
    useMutation: () => [mockMutation, { loading: false }]
  }));

  const { PostComponent } = await import('@/components/PostComponent');
  render(<PostComponent postId="1" />);

  const likeButton = screen.getByRole('button', { name: 'Like' });
  fireEvent.click(likeButton);

  // Verify optimistic update
  expect(screen.getByText('11 likes')).toBeInTheDocument();
  expect(mockMutation).toHaveBeenCalledWith({
    variables: { postId: '1' },
    optimisticResponse: expect.any(Object)
  });
});</code></pre>

          <h2 id="advanced-usage">Advanced Usage</h2>

          <h3 id="custom-hook-properties">Custom Hook Properties</h3>

          <p>
            You can customize the mock to include additional Apollo Client
            properties:
          </p>

          <pre><code class="language-typescript">const customMockQuery = createMockGraphQLHook('GetData', mockData);

// Add custom properties
customMockQuery.networkStatus = 7; // NetworkStatus.ready
customMockQuery.called = true;
customMockQuery.client = mockApolloClient;
customMockQuery.fetchMore = createMock();
customMockQuery.subscribeToMore = createMock();</code></pre>

          <h3 id="mocking-subscriptions">Mocking Subscriptions</h3>

          <pre><code class="language-typescript">test('mocks GraphQL subscription', async () => {
  const mockSubscription = {
    data: { messageAdded: { id: '1', text: 'New message', user: 'John' } },
    loading: false,
    error: null
  };

  await mockModules.mock('@apollo/client', () => ({
    useSubscription: () => mockSubscription
  }));

  const { ChatComponent } = await import('@/components/ChatComponent');
  render(<ChatComponent />);

  expect(screen.getByText('New message')).toBeInTheDocument();
  expect(screen.getByText('from John')).toBeInTheDocument();
});</code></pre>

          <h3 id="testing-pagination">Testing Pagination</h3>

          <pre><code class="language-typescript">test('handles pagination with fetchMore', async () => {
  const initialData = {
    posts: {
      items: [{ id: '1', title: 'Post 1' }],
      hasNextPage: true,
      cursor: 'cursor1'
    }
  };

  const mockQuery = createMockGraphQLHook('GetPosts', initialData);

  // Mock fetchMore behavior
  mockQuery.fetchMore.mockResolvedValue({
    data: {
      posts: {
        items: [{ id: '2', title: 'Post 2' }],
        hasNextPage: false,
        cursor: 'cursor2'
      }
    }
  });

  await mockModules.mock('@apollo/client', () => ({
    useQuery: () => mockQuery
  }));

  const { PostsList } = await import('@/components/PostsList');
  render(<PostsList />);

  expect(screen.getByText('Post 1')).toBeInTheDocument();

  const loadMoreButton = screen.getByRole('button', { name: 'Load More' });
  fireEvent.click(loadMoreButton);

  expect(mockQuery.fetchMore).toHaveBeenCalledWith({
    variables: { cursor: 'cursor1' }
  });
});</code></pre>

          <h2 id="best-practices">Best Practices</h2>

          <h3 id="use-realistic-data-structures">
            1. Use Realistic Data Structures
          </h3>

          <p>
            Make your mock data match the actual GraphQL schema:
          </p>

          <div class="callout callout-success">
            <pre><code class="language-typescript">// ✅ Match your GraphQL schema
const mockUserData = {
  id: '1',
  name: 'John Doe',
  email: 'john@example.com',
  profile: {
    bio: 'Software developer',
    avatar: 'https://example.com/avatar.jpg'
  },
  posts: [
    { id: '1', title: 'First Post', createdAt: '2023-01-01' }
  ]
};</code></pre>
          </div>

          <h3 id="test-all-states">2. Test All States</h3>

          <p>
            Ensure you test loading, success, and error states:
          </p>

          <pre><code class="language-typescript">describe('UserProfile', () => {
  test('loading state', async () => {
    await mockModules.mock('@apollo/client', () => ({
      useQuery: createMockGraphQLHook('GetUser', null, true, null)
    }));
    // Test loading UI
  });

  test('success state', async () => {
    await mockModules.mock('@apollo/client', () => ({
      useQuery: createMockGraphQLHook('GetUser', mockUserData, false, null)
    }));
    // Test with data
  });

  test('error state', async () => {
    await mockModules.mock('@apollo/client', () => ({
      useQuery: createMockGraphQLHook('GetUser', null, false, new Error('Failed'))
    }));
    // Test error handling
  });
});</code></pre>

          <h3 id="use-operation-names">3. Use Operation Names</h3>

          <p>
            Always provide meaningful operation names for debugging:
          </p>

          <div class="callout callout-success">
            <pre><code class="language-typescript">// ✅ Descriptive operation names
createMockGraphQLHook('GetUserProfile', userData)
createMockGraphQLHook('UpdateUserSettings', updatedSettings)
createMockGraphQLHook('SearchProductsLazy', searchResults)</code></pre>
          </div>

          <h2 id="troubleshooting">Troubleshooting</h2>

          <h3 id="mock-not-matching-apollo-interface">
            Mock Not Matching Apollo Interface
          </h3>

          <p>
            Ensure your mock includes all properties that your component
            expects:
          </p>

          <pre><code class="language-typescript">// If your component checks for specific properties
const completeMock = createMockGraphQLHook('GetData', mockData);
completeMock.networkStatus = 7;
completeMock.called = true;
completeMock.previousData = undefined;</code></pre>

          <h3 id="lazy-query-not-working">Lazy Query Not Working</h3>

          <p>
            Ensure the operation name contains "Lazy" to trigger lazy query
            behavior:
          </p>

          <div class="callout callout-error">
            <pre><code class="language-typescript">// ❌ Won't be treated as lazy query
createMockGraphQLHook('SearchUsers', data)</code></pre>
          </div>

          <div class="callout callout-success">
            <pre><code class="language-typescript">// ✅ Will return [executeFunction, result] tuple
createMockGraphQLHook('SearchUsersLazy', data)</code></pre>
          </div>

          <div class="page-navigation">
            <a href="component-mocking.html" class="nav-prev">Component Mocking</a>
            <a href="module-mocking.html" class="nav-next">Module Mocking</a>
          </div>

          <h2 id="see-also">See Also</h2>

          <ul>
            <li>
              <a href="graphql-testing.html">GraphQL Testing</a> - Complete
              examples and patterns
            </li>
            <li>
              <a href="hook-mocking.html">Hook Mocking</a> - For mocking other
              React hooks
            </li>
            <li>
              <a href="module-mocking.html">Module Mocking</a> - For mocking
              entire modules
            </li>
            <li>
              <a href="testing-patterns.html">Testing Patterns</a> - Advanced
              testing strategies
            </li>
          </ul>
        </div>
      </main>
    </div>

    <script src="js/gitbook.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
