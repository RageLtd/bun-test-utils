<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Partial Mocks - @rageltd/bun-test-utils</title>
    <meta
      name="description"
      content="Partial Mocks documentation for @rageltd/bun-test-utils"
    />
    <link rel="stylesheet" href="css/gitbook.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  </head>
  <body>
    <button class="mobile-toggle">☰</button>

    <div class="gitbook-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <h1 class="sidebar-title"><a href="https://github.com/rageltd/bun-test-utils" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">@rageltd/bun-test-utils</a></h1>
          <p class="sidebar-subtitle">Test utilities for Bun projects</p>
        </div>

        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="Search documentation..."
          />
        </div>

        <nav class="nav-menu">
          <div class="nav-section">
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="index.html" class="nav-link">Introduction</a>
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Getting Started</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="installation.html" class="nav-link">Installation</a>
              </li>
              <li class="nav-item">
                <a href="quick-start.html" class="nav-link">Quick Start</a>
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">API Reference</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="async-utilities.html" class="nav-link"
                  >Async Utilities</a
                >
              </li>
              <li class="nav-item">
                <a href="mock-utilities.html" class="nav-link"
                  >Mock Utilities</a
                >
              </li>
              <li class="nav-item">
                <a href="hook-mocking.html" class="nav-link">Hook Mocking</a>
              </li>
              <li class="nav-item">
                <a href="component-mocking.html" class="nav-link"
                  >Component Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="graphql-mocking.html" class="nav-link"
                  >GraphQL Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="module-mocking.html" class="nav-link"
                  >Module Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="partial-mocks.html" class="nav-link active"
                  >Partial Mocks</a
                >
              </li>
              <li class="nav-item">
                <a href="spy-utilities.html" class="nav-link">Spy Utilities</a>
              </li>
              <li class="nav-item">
                <a href="cleanup-utilities.html" class="nav-link"
                  >Cleanup Utilities</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Guides</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="testing-patterns.html" class="nav-link"
                  >Testing Patterns</a
                >
              </li>
              <li class="nav-item">
                <a href="working-with-bun.html" class="nav-link"
                  >Working with Bun</a
                >
              </li>
              <li class="nav-item">
                <a href="common-issues.html" class="nav-link">Common Issues</a>
              </li>
              <li class="nav-item">
                <a href="migration-guide.html" class="nav-link"
                  >Migration Guide</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Examples</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="basic-testing.html" class="nav-link">Basic Testing</a>
              </li>
              <li class="nav-item">
                <a href="react-components.html" class="nav-link"
                  >React Components</a
                >
              </li>
              <li class="nav-item">
                <a href="graphql-testing.html" class="nav-link"
                  >GraphQL Testing</a
                >
              </li>
              <li class="nav-item">
                <a href="module-mocking-examples.html" class="nav-link"
                  >Module Mocking</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Contributing</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="development-setup.html" class="nav-link"
                  >Development Setup</a
                >
              </li>
              <li class="nav-item">
                <a href="semantic-commits.html" class="nav-link"
                  >Semantic Commits</a
                >
              </li>
              <li class="nav-item">
                <a href="release-process.html" class="nav-link"
                  >Release Process</a
                >
              </li>
            </ul>
          </div>
        </nav>
      </aside>

      <main class="main-content">
        <div class="content-wrapper">
          <h1>Partial Mocks</h1>

          <p>
            The partial mocks module provides utilities for creating type-safe
            partial mock objects. This is useful when you need to mock only
            specific properties of an object while maintaining type safety and
            providing default values for the rest.
          </p>

          <h2 id="createpartialmock">createPartialMock</h2>

          <h3 id="signature">Signature</h3>

          <pre><code class="language-typescript">function createPartialMock&lt;T&gt;(
  original?: Partial&lt;T&gt;,
  overrides?: Partial&lt;T&gt;
): T</code></pre>

          <h3 id="description">Description</h3>

          <p>
            Creates a partial mock object by merging an original object with
            override values. This function provides a type-safe way to create
            mock objects that only specify the properties you care about in
            your tests.
          </p>

          <h3 id="parameters">Parameters</h3>

          <table>
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>original</code></td>
                <td><code>Partial&lt;T&gt;</code></td>
                <td>Base object with default values (optional)</td>
              </tr>
              <tr>
                <td><code>overrides</code></td>
                <td><code>Partial&lt;T&gt;</code></td>
                <td>Properties to override or add (optional)</td>
              </tr>
            </tbody>
          </table>

          <h3 id="returns">Returns</h3>

          <p>
            <code>T</code> - A merged object with proper typing, containing
            properties from both original and overrides
          </p>

          <h3 id="examples">Examples</h3>

          <h4 id="basic-partial-mocking">Basic Partial Mocking</h4>

          <pre><code class="language-typescript">import { createPartialMock } from '@rageltd/bun-test-utils';
import { test, expect } from 'bun:test';

interface User {
  id: number;
  name: string;
  email: string;
  role: 'admin' | 'user';
  isActive: boolean;
}

test('creates partial mock with minimal data', () => {
  const mockUser = createPartialMock&lt;User&gt;({}, {
    id: 1,
    name: 'Test User'
  });

  // TypeScript knows this is a User, but only id and name are guaranteed
  expect(mockUser.id).toBe(1);
  expect(mockUser.name).toBe('Test User');
});</code></pre>

          <h4 id="providing-defaults">Providing Defaults</h4>

          <pre><code class="language-typescript">import { createPartialMock } from '@rageltd/bun-test-utils';

interface ApiResponse {
  status: number;
  message: string;
  data: any;
  timestamp: Date;
  requestId: string;
}

const defaultApiResponse: Partial&lt;ApiResponse&gt; = {
  status: 200,
  message: 'Success',
  timestamp: new Date('2023-01-01'),
  requestId: 'req-123'
};

test('uses default values with overrides', () => {
  const mockResponse = createPartialMock&lt;ApiResponse&gt;(
    defaultApiResponse,
    {
      data: { users: [{ id: 1, name: 'John' }] },
      status: 201 // Override the default status
    }
  );

  expect(mockResponse.status).toBe(201); // Overridden
  expect(mockResponse.message).toBe('Success'); // From default
  expect(mockResponse.data.users).toHaveLength(1); // From override
  expect(mockResponse.requestId).toBe('req-123'); // From default
});</code></pre>

          <h4 id="testing-error-responses">Testing Error Responses</h4>

          <pre><code class="language-typescript">import { createPartialMock } from '@rageltd/bun-test-utils';

interface ErrorResponse {
  status: number;
  error: string;
  details: string[];
  code: string;
  timestamp: Date;
}

const baseError: Partial&lt;ErrorResponse&gt; = {
  status: 400,
  timestamp: new Date(),
  details: []
};

test('creates different error scenarios', () => {
  const validationError = createPartialMock&lt;ErrorResponse&gt;(baseError, {
    error: 'Validation failed',
    code: 'VALIDATION_ERROR',
    details: ['Name is required', 'Email is invalid']
  });

  const authError = createPartialMock&lt;ErrorResponse&gt;(baseError, {
    status: 401,
    error: 'Unauthorized',
    code: 'AUTH_ERROR'
  });

  const serverError = createPartialMock&lt;ErrorResponse&gt;(baseError, {
    status: 500,
    error: 'Internal server error',
    code: 'SERVER_ERROR'
  });

  expect(validationError.details).toHaveLength(2);
  expect(authError.status).toBe(401);
  expect(serverError.code).toBe('SERVER_ERROR');
});</code></pre>

          <h4 id="mocking-complex-objects">Mocking Complex Objects</h4>

          <pre><code class="language-typescript">import { createPartialMock } from '@rageltd/bun-test-utils';

interface Product {
  id: string;
  name: string;
  price: number;
  category: {
    id: string;
    name: string;
    slug: string;
  };
  inventory: {
    inStock: boolean;
    quantity: number;
    warehouse: string;
  };
  metadata: {
    createdAt: Date;
    updatedAt: Date;
    createdBy: string;
  };
}

const productDefaults: Partial&lt;Product&gt; = {
  category: {
    id: 'cat-1',
    name: 'Default Category',
    slug: 'default'
  },
  inventory: {
    inStock: true,
    quantity: 10,
    warehouse: 'main'
  },
  metadata: {
    createdAt: new Date('2023-01-01'),
    updatedAt: new Date('2023-01-01'),
    createdBy: 'system'
  }
};

test('creates complex product mock', () => {
  const mockProduct = createPartialMock&lt;Product&gt;(productDefaults, {
    id: 'prod-123',
    name: 'Test Product',
    price: 29.99,
    inventory: {
      ...productDefaults.inventory!,
      quantity: 5 // Override just the quantity
    }
  });

  expect(mockProduct.name).toBe('Test Product');
  expect(mockProduct.price).toBe(29.99);
  expect(mockProduct.inventory.quantity).toBe(5);
  expect(mockProduct.inventory.inStock).toBe(true); // From defaults
  expect(mockProduct.category.name).toBe('Default Category'); // From defaults
});</code></pre>

          <h4 id="testing-configuration-objects">Testing Configuration Objects</h4>

          <pre><code class="language-typescript">import { createPartialMock } from '@rageltd/bun-test-utils';

interface AppConfig {
  database: {
    host: string;
    port: number;
    name: string;
    ssl: boolean;
  };
  api: {
    baseUrl: string;
    timeout: number;
    retries: number;
  };
  features: {
    enableAnalytics: boolean;
    enableChat: boolean;
    enableNotifications: boolean;
  };
  logging: {
    level: 'debug' | 'info' | 'warn' | 'error';
    enableConsole: boolean;
    enableFile: boolean;
  };
}

const testConfigDefaults: Partial&lt;AppConfig&gt; = {
  database: {
    host: 'localhost',
    port: 5432,
    name: 'test_db',
    ssl: false
  },
  api: {
    baseUrl: 'http://localhost:3000',
    timeout: 5000,
    retries: 3
  },
  features: {
    enableAnalytics: false,
    enableChat: false,
    enableNotifications: false
  },
  logging: {
    level: 'debug',
    enableConsole: true,
    enableFile: false
  }
};

test('tests configuration variations', () => {
  const prodLikeConfig = createPartialMock&lt;AppConfig&gt;(testConfigDefaults, {
    database: {
      ...testConfigDefaults.database!,
      host: 'prod-db.example.com',
      ssl: true
    },
    features: {
      ...testConfigDefaults.features!,
      enableAnalytics: true,
      enableNotifications: true
    },
    logging: {
      ...testConfigDefaults.logging!,
      level: 'warn',
      enableFile: true
    }
  });

  expect(prodLikeConfig.database.ssl).toBe(true);
  expect(prodLikeConfig.features.enableAnalytics).toBe(true);
  expect(prodLikeConfig.logging.level).toBe('warn');
  expect(prodLikeConfig.api.timeout).toBe(5000); // From defaults
});</code></pre>

          <h2 id="advanced-patterns">Advanced Patterns</h2>

          <h3 id="factory-functions">Factory Functions</h3>

          <p>Create reusable factory functions for common test scenarios:</p>

          <pre><code class="language-typescript">import { createPartialMock } from '@rageltd/bun-test-utils';

// Create factory functions for different user types
function createTestUser(overrides: Partial&lt;User&gt; = {}): User {
  return createPartialMock&lt;User&gt;({
    id: 1,
    name: 'Test User',
    email: 'test@example.com',
    role: 'user',
    isActive: true
  }, overrides);
}

function createAdminUser(overrides: Partial&lt;User&gt; = {}): User {
  return createPartialMock&lt;User&gt;({
    id: 999,
    name: 'Admin User',
    email: 'admin@example.com',
    role: 'admin',
    isActive: true
  }, overrides);
}

function createInactiveUser(overrides: Partial&lt;User&gt; = {}): User {
  return createPartialMock&lt;User&gt;({
    id: 0,
    name: 'Inactive User',
    email: 'inactive@example.com',
    role: 'user',
    isActive: false
  }, overrides);
}

// Use in tests
test('different user types', () => {
  const regularUser = createTestUser({ name: 'John Doe' });
  const admin = createAdminUser();
  const inactive = createInactiveUser({ email: 'old@example.com' });

  expect(regularUser.role).toBe('user');
  expect(admin.role).toBe('admin');
  expect(inactive.isActive).toBe(false);
});</code></pre>

          <h3 id="builder-pattern">Builder Pattern</h3>

          <p>Combine partial mocks with builder patterns for complex objects:</p>

          <pre><code class="language-typescript">class ProductBuilder {
  private product: Partial&lt;Product&gt; = {
    id: 'prod-123',
    name: 'Default Product',
    price: 10.00,
    category: { id: 'cat-1', name: 'Category', slug: 'category' },
    inventory: { inStock: true, quantity: 10, warehouse: 'main' },
    metadata: {
      createdAt: new Date(),
      updatedAt: new Date(),
      createdBy: 'system'
    }
  };

  withName(name: string): ProductBuilder {
    this.product.name = name;
    return this;
  }

  withPrice(price: number): ProductBuilder {
    this.product.price = price;
    return this;
  }

  outOfStock(): ProductBuilder {
    this.product.inventory = {
      ...this.product.inventory!,
      inStock: false,
      quantity: 0
    };
    return this;
  }

  inCategory(categoryName: string): ProductBuilder {
    this.product.category = {
      ...this.product.category!,
      name: categoryName,
      slug: categoryName.toLowerCase().replace(/\s+/g, '-')
    };
    return this;
  }

  build(): Product {
    return createPartialMock&lt;Product&gt;({}, this.product);
  }
}

// Use in tests
test('builder pattern with partial mocks', () => {
  const expensiveOutOfStockProduct = new ProductBuilder()
    .withName('Premium Widget')
    .withPrice(199.99)
    .outOfStock()
    .inCategory('Premium Items')
    .build();

  expect(expensiveOutOfStockProduct.name).toBe('Premium Widget');
  expect(expensiveOutOfStockProduct.price).toBe(199.99);
  expect(expensiveOutOfStockProduct.inventory.inStock).toBe(false);
  expect(expensiveOutOfStockProduct.category.name).toBe('Premium Items');
});</code></pre>

          <h3 id="nested-partial-mocks">Nested Partial Mocks</h3>

          <p>Handle deeply nested objects by combining multiple partial mocks:</p>

          <pre><code class="language-typescript">interface OrderItem {
  id: string;
  product: Product;
  quantity: number;
  unitPrice: number;
}

interface Order {
  id: string;
  customer: User;
  items: OrderItem[];
  total: number;
  status: 'pending' | 'confirmed' | 'shipped' | 'delivered';
  shipping: {
    address: string;
    city: string;
    zipCode: string;
    carrier: string;
    trackingNumber?: string;
  };
}

function createTestOrder(overrides: Partial&lt;Order&gt; = {}): Order {
  const defaultCustomer = createTestUser();
  const defaultProduct = createPartialMock&lt;Product&gt;({}, {
    id: 'prod-1',
    name: 'Test Product',
    price: 25.00
  });

  const defaultItem = createPartialMock&lt;OrderItem&gt;({}, {
    id: 'item-1',
    product: defaultProduct,
    quantity: 2,
    unitPrice: 25.00
  });

  return createPartialMock&lt;Order&gt;({
    id: 'order-123',
    customer: defaultCustomer,
    items: [defaultItem],
    total: 50.00,
    status: 'pending',
    shipping: {
      address: '123 Test St',
      city: 'Test City',
      zipCode: '12345',
      carrier: 'Test Carrier'
    }
  }, overrides);
}

test('creates complex nested order', () => {
  const shippedOrder = createTestOrder({
    status: 'shipped',
    shipping: {
      address: '456 Real St',
      city: 'Real City',
      zipCode: '67890',
      carrier: 'FedEx',
      trackingNumber: 'TRK123456'
    }
  });

  expect(shippedOrder.status).toBe('shipped');
  expect(shippedOrder.shipping.trackingNumber).toBe('TRK123456');
  expect(shippedOrder.customer.name).toBe('Test User'); // From defaults
  expect(shippedOrder.items[0].product.name).toBe('Test Product'); // From defaults
});</code></pre>

          <h2 id="best-practices">Best Practices</h2>

          <h3 id="use-meaningful-defaults">1. Use Meaningful Defaults</h3>

          <p>Provide sens</p>ible defaults that work for most test cases:</p>

          <div class="callout callout-success">
            <pre><code class="language-typescript">// ✅ Good defaults that make sense
            const userDefaults: Partial&lt;User&gt; = {
  id: 1,
  name: 'Test User',
  email: 'test@example.com',
  role: 'user',
  isActive: true,
  createdAt: new Date('2023-01-01')
};</code></pre>
          </div>

          <div class="callout callout-error">
            <pre><code class="language-typescript">// ❌ Avoid meaningless or confusing defaults
const userDefaults: Partial&lt;User&gt; = {
  id: 999999999,
  name: 'XXXXX',
  email: 'fake@fake.fake',
  role: 'admin' // Surprising default
};</code></pre>
          </div>

          <h3 id="keep-interfaces-simple">2. Keep Interfaces Simple</h3>

          <p>Design your interfaces to work well with partial mocking:</p>

          <pre><code class="language-typescript">// ✅ Good interface design
interface ApiConfig {
  baseUrl: string;
  timeout: number;
  retries: number;
}

// ✅ Can easily create partial mocks
const config = createPartialMock&lt;ApiConfig&gt;({
  timeout: 5000,
  retries: 3
}, {
  baseUrl: 'https://api.example.com'
});</code></pre>

          <h3 id="combine-with-type-guards">3. Combine with Type Guards</h3>

          <p>Use partial mocks with type guards for safer testing:</p>

          <pre><code class="language-typescript">function isValidUser(user: Partial&lt;User&gt;): user is User {
  return !!(user.id && user.name && user.email);
}

test('validates user objects', () => {
  const completeUser = createPartialMock&lt;User&gt;({}, {
    id: 1,
    name: 'John',
    email: 'john@example.com',
    role: 'user',
    isActive: true
  });

  const incompleteUser = createPartialMock&lt;User&gt;({}, {
    id: 1,
    name: 'John'
    // missing email
  });

  expect(isValidUser(completeUser)).toBe(true);
  expect(isValidUser(incompleteUser)).toBe(false);
});</code></pre>

          <h3 id="document-mock-purposes">4. Document Mock Purposes</h3>

          <p>Use descriptive variable names and comments:</p>

          <pre><code class="language-typescript">test('user permissions', () => {
  // Mock an admin user for permission testing
  const adminUser = createPartialMock&lt;User&gt;(userDefaults, {
    role: 'admin',
    name: 'Admin User'
  });

  // Mock a suspended user for negative testing
  const suspendedUser = createPartialMock&lt;User&gt;(userDefaults, {
    isActive: false,
    name: 'Suspended User'
  });

  // Test admin permissions
  expect(canDeletePosts(adminUser)).toBe(true);

  // Test suspended user restrictions
  expect(canDeletePosts(suspendedUser)).toBe(false);
});</code></pre>

          <h2 id="troubleshooting">Troubleshooting</h2>

          <h3 id="typescript-strict-mode">TypeScript Strict Mode</h3>

          <p>
            In strict mode, TypeScript may complain about missing properties.
            Use type assertions when necessary:
          </p>

          <pre><code class="language-typescript">// If TypeScript complains about missing properties
const partialUser = createPartialMock&lt;User&gt;({}, {
  id: 1,
  name: 'Test'
}) as User;

// Or define what properties are actually needed
function processUser(user: Pick&lt;User, 'id' | 'name'&gt;) {
  // Function only needs id and name
}

const minimalUser = createPartialMock({}, { id: 1, name: 'Test' });
processUser(minimalUser); // Works fine</code></pre>

          <h3 id="deep-merge-issues">Deep Merge Issues</h3>

          <p>
            <code>createPartialMock</code> does shallow merging. For deep
            merging, you need to handle nested objects manually:
          </p>

          <pre><code class="language-typescript">// ❌ This will replace the entire settings object
const user = createPartialMock&lt;User&gt;(defaultUser, {
  settings: { theme: 'dark' } // This replaces all settings
});

// ✅ Manually merge nested objects
const user = createPartialMock&lt;User&gt;(defaultUser, {
  settings: {
    ...defaultUser.settings,
    theme: 'dark' // This preserves other settings
  }
});</code></pre>

          <div class="page-navigation">
            <a href="module-mocking.html" class="nav-prev">Module Mocking</a>
            <a href="spy-utilities.html" class="nav-next">Spy Utilities</a>
          </div>

          <h2 id="see-also">See Also</h2>

          <ul>
            <li>
              <a href="mock-utilities.html">Mock Utilities</a> - Basic mock
              function utilities
            </li>
            <li>
              <a href="module-mocking.html">Module Mocking</a> - For mocking
              entire modules
            </li>
            <li>
              <a href="testing-patterns.html">Testing Patterns</a> - Advanced
              testing strategies
            </li>
            <li>
              <a href="basic-testing.html">Basic Testing</a> - Simple testing
              examples
            </li>
          </ul>
        </div>
      </main>
    </div>

    <script src="js/gitbook.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
