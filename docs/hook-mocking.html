<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hook Mocking - @rageltd/bun-test-utils</title>
    <meta
      name="description"
      content="Hook Mocking documentation for @rageltd/bun-test-utils"
    />
    <link rel="stylesheet" href="css/gitbook.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  </head>
  <body>
    <button class="mobile-toggle">☰</button>

    <div class="gitbook-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <h1 class="sidebar-title">@rageltd/bun-test-utils</h1>
          <p class="sidebar-subtitle">Test utilities for Bun projects</p>
        </div>

        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="Search documentation..."
          />
        </div>

        <nav class="nav-menu">
          <div class="nav-section">
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="index.html" class="nav-link">Introduction</a>
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Getting Started</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="installation.html" class="nav-link">Installation</a>
              </li>
              <li class="nav-item">
                <a href="quick-start.html" class="nav-link">Quick Start</a>
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">API Reference</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="async-utilities.html" class="nav-link"
                  >Async Utilities</a
                >
              </li>
              <li class="nav-item">
                <a href="mock-utilities.html" class="nav-link"
                  >Mock Utilities</a
                >
              </li>
              <li class="nav-item">
                <a href="hook-mocking.html" class="nav-link active"
                  >Hook Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="component-mocking.html" class="nav-link"
                  >Component Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="graphql-mocking.html" class="nav-link"
                  >GraphQL Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="module-mocking.html" class="nav-link"
                  >Module Mocking</a
                >
              </li>
              <li class="nav-item">
                <a href="partial-mocks.html" class="nav-link">Partial Mocks</a>
              </li>
              <li class="nav-item">
                <a href="spy-utilities.html" class="nav-link">Spy Utilities</a>
              </li>
              <li class="nav-item">
                <a href="cleanup-utilities.html" class="nav-link"
                  >Cleanup Utilities</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Guides</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="testing-patterns.html" class="nav-link"
                  >Testing Patterns</a
                >
              </li>
              <li class="nav-item">
                <a href="working-with-bun.html" class="nav-link"
                  >Working with Bun</a
                >
              </li>
              <li class="nav-item">
                <a href="common-issues.html" class="nav-link">Common Issues</a>
              </li>
              <li class="nav-item">
                <a href="migration-guide.html" class="nav-link"
                  >Migration Guide</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Examples</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="basic-testing.html" class="nav-link">Basic Testing</a>
              </li>
              <li class="nav-item">
                <a href="react-components.html" class="nav-link"
                  >React Components</a
                >
              </li>
              <li class="nav-item">
                <a href="graphql-testing.html" class="nav-link"
                  >GraphQL Testing</a
                >
              </li>
              <li class="nav-item">
                <a href="module-mocking-examples.html" class="nav-link"
                  >Module Mocking</a
                >
              </li>
            </ul>
          </div>
          <div class="nav-section">
            <h3 class="nav-section-title">Contributing</h3>
            <ul class="nav-subsection">
              <li class="nav-item">
                <a href="development-setup.html" class="nav-link"
                  >Development Setup</a
                >
              </li>
              <li class="nav-item">
                <a href="semantic-commits.html" class="nav-link"
                  >Semantic Commits</a
                >
              </li>
              <li class="nav-item">
                <a href="release-process.html" class="nav-link"
                  >Release Process</a
                >
              </li>
            </ul>
          </div>
        </nav>
      </aside>

      <main class="main-content">
        <div class="content-wrapper">
          <h1>Hook Mocking</h1>

          <p>
            The hook mocking module provides utilities for mocking React hooks
            in your tests, making it easy to control hook behavior and test
            components in isolation.
          </p>

          <h2 id="createmockhook">createMockHook</h2>

          <h3 id="signature">Signature</h3>

          <pre><code class="language-typescript">function createMockHook&lt;T&gt;(hookName: string, returnValue: T): ReturnType&lt;typeof mock&gt;</code></pre>

          <h3 id="description">Description</h3>

          <p>
            Creates a mock function that represents a React hook with a
            specified return value. This is particularly useful for:
          </p>

          <ul>
            <li>Mocking custom hooks in component tests</li>
            <li>Controlling hook behavior for different test scenarios</li>
            <li>Testing component behavior with various hook states</li>
            <li>Isolating components from complex hook logic</li>
          </ul>

          <h3 id="parameters">Parameters</h3>

          <table>
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>hookName</code></td>
                <td><code>string</code></td>
                <td>Name of the hook (for debugging purposes)</td>
              </tr>
              <tr>
                <td><code>returnValue</code></td>
                <td><code>T</code></td>
                <td>Default value that the mock hook should return</td>
              </tr>
            </tbody>
          </table>

          <h3 id="returns">Returns</h3>

          <p>
            <code>ReturnType&lt;typeof mock&gt;</code> - A mock function that
            returns the specified value
          </p>

          <h3 id="examples">Examples</h3>

          <h4 id="basic-hook-mocking">Basic Hook Mocking</h4>

          <pre><code class="language-typescript">import { createMockHook, createModuleMocker } from '@rageltd/bun-test-utils';
import { test, expect, beforeEach, afterAll } from 'bun:test';

const mockModules = createModuleMocker();

test('mocks a simple hook', async () => {
  await mockModules.mock('@/hooks', () => ({
    useUser: createMockHook('useUser', {
      id: 1,
      name: 'Test User',
      email: 'test@example.com'
    })
  }));

  const { useUser } = await import('@/hooks');
  const user = useUser();

  expect(user).toEqual({
    id: 1,
    name: 'Test User',
    email: 'test@example.com'
  });
});</code></pre>

          <h4 id="mocking-stateful-hooks">Mocking Stateful Hooks</h4>

          <pre><code class="language-typescript">import { createMockHook } from '@rageltd/bun-test-utils';

test('mocks useState-like hook', async () => {
  const mockUseCounter = createMockHook('useCounter', {
    count: 5,
    increment: createMock(),
    decrement: createMock(),
    reset: createMock()
  });

  await mockModules.mock('@/hooks', () => ({
    useCounter: mockUseCounter
  }));

  const { useCounter } = await import('@/hooks');
  const counter = useCounter();

  expect(counter.count).toBe(5);
  expect(counter.increment).toBeDefined();
  expect(counter.decrement).toBeDefined();
  expect(counter.reset).toBeDefined();
});</code></pre>

          <h4 id="mocking-async-hooks">Mocking Async Hooks</h4>

          <pre><code class="language-typescript">import { createMockHook } from '@rageltd/bun-test-utils';

test('mocks async data hook', async () => {
  const mockUseAsyncData = createMockHook('useAsyncData', {
    data: { message: 'Hello World' },
    loading: false,
    error: null,
    refetch: createMock(() => Promise.resolve())
  });

  await mockModules.mock('@/hooks', () => ({
    useAsyncData: mockUseAsyncData
  }));

  const { useAsyncData } = await import('@/hooks');
  const result = useAsyncData();

  expect(result.data).toEqual({ message: 'Hello World' });
  expect(result.loading).toBe(false);
  expect(result.error).toBeNull();
});</code></pre>

          <h4 id="testing-different-hook-states">
            Testing Different Hook States
          </h4>

          <pre><code class="language-typescript">import { render, screen } from '@testing-library/react';
import { createMockHook, createModuleMocker } from '@rageltd/bun-test-utils';

const mockModules = createModuleMocker();

describe('UserProfile component', () => {
  afterAll(() => {
    mockModules.restoreAll();
  });

  test('renders loading state', async () => {
    await mockModules.mock('@/hooks', () => ({
      useUser: createMockHook('useUser', {
        data: null,
        loading: true,
        error: null
      })
    }));

    const { UserProfile } = await import('@/components/UserProfile');
    render(&lt;UserProfile /&gt;);

    expect(screen.getByText('Loading...')).toBeInTheDocument();
  });

  test('renders user data', async () => {
    await mockModules.mock('@/hooks', () => ({
      useUser: createMockHook('useUser', {
        data: { name: 'John Doe', email: 'john@example.com' },
        loading: false,
        error: null
      })
    }));

    const { UserProfile } = await import('@/components/UserProfile');
    render(&lt;UserProfile /&gt;);

    expect(screen.getByText('John Doe')).toBeInTheDocument();
    expect(screen.getByText('john@example.com')).toBeInTheDocument();
  });

  test('renders error state', async () => {
    await mockModules.mock('@/hooks', () => ({
      useUser: createMockHook('useUser', {
        data: null,
        loading: false,
        error: new Error('Failed to load user')
      })
    }));

    const { UserProfile } = await import('@/components/UserProfile');
    render(&lt;UserProfile /&gt;);

    expect(screen.getByText('Failed to load user')).toBeInTheDocument();
  });
});</code></pre>

          <h4 id="mocking-form-hooks">Mocking Form Hooks</h4>

          <pre><code class="language-typescript">import { createMockHook } from '@rageltd/bun-test-utils';
import { fireEvent } from '@testing-library/react';

test('mocks form hook', async () => {
  const mockHandleSubmit = createMock();
  const mockRegister = createMock();

  await mockModules.mock('react-hook-form', () => ({
    useForm: createMockHook('useForm', {
      register: mockRegister,
      handleSubmit: mockHandleSubmit,
      formState: { errors: {} },
      setValue: createMock(),
      getValues: createMock(),
      reset: createMock()
    })
  }));

  const { ContactForm } = await import('@/components/ContactForm');
  render(&lt;ContactForm /&gt;);

  const submitButton = screen.getByRole('button', { name: 'Submit' });
  fireEvent.click(submitButton);

  expect(mockHandleSubmit).toHaveBeenCalled();
});</code></pre>

          <h2 id="best-practices">Best Practices</h2>

          <h3 id="use-realistic-return-values">
            1. Use Realistic Return Values
          </h3>

          <p>Make your mock return values match the actual hook's interface:</p>

          <div class="callout callout-success">
            <pre><code class="language-typescript">// ✅ Match the real hook interface
const mockUseAuth = createMockHook('useAuth', {
  user: { id: 1, name: 'Test User' },
  isAuthenticated: true,
  login: createMock(),
  logout: createMock(),
  loading: false
});</code></pre>
          </div>

          <div class="callout callout-error">
            <pre><code class="language-typescript">// ❌ Incomplete or incorrect interface
const mockUseAuth = createMockHook('useAuth', {
  user: 'Test User' // Should be an object
});</code></pre>
          </div>

          <h3 id="test-multiple-states">2. Test Multiple States</h3>

          <p>
            Create tests for different hook states (loading, success, error):
          </p>

          <pre><code class="language-typescript">describe('Component with async hook', () => {
  test.each([
    { loading: true, data: null, expected: 'Loading...' },
    { loading: false, data: { name: 'John' }, expected: 'John' },
    { loading: false, data: null, expected: 'No data' }
  ])('renders correctly for state: %o', async ({ loading, data, expected }) => {
    await mockModules.mock('@/hooks', () => ({
      useData: createMockHook('useData', { loading, data })
    }));

    render(&lt;MyComponent /&gt;);
    expect(screen.getByText(expected)).toBeInTheDocument();
  });
});</code></pre>

          <h3 id="combine-with-module-mocking">
            3. Combine with Module Mocking
          </h3>

          <p>
            Use hook mocking together with module mocking for complete
            isolation:
          </p>

          <pre><code class="language-typescript">import { createModuleMocker, createMockHook } from '@rageltd/bun-test-utils';

const mockModules = createModuleMocker();

beforeEach(async () => {
  await mockModules.mock('@/hooks', () => ({
    useUser: createMockHook('useUser', defaultUserData),
    useAuth: createMockHook('useAuth', defaultAuthData)
  }));
});

afterAll(() => {
  mockModules.restoreAll();
});</code></pre>

          <h3 id="update-return-values-during-tests">
            4. Update Return Values During Tests
          </h3>

          <p>You can change mock return values during tests:</p>

          <pre><code class="language-typescript">test('handles state changes', async () => {
  const mockUseCounter = createMockHook('useCounter', { count: 0 });

  // Test initial state
  expect(mockUseCounter().count).toBe(0);

  // Update the mock's return value
  mockUseCounter.mockReturnValue({ count: 5 });

  expect(mockUseCounter().count).toBe(5);
});</code></pre>

          <h2 id="common-patterns">Common Patterns</h2>

          <h3 id="authentication-hooks">Authentication Hooks</h3>

          <pre><code class="language-typescript">const mockUseAuth = createMockHook('useAuth', {
  user: { id: 1, name: 'Test User', role: 'admin' },
  isAuthenticated: true,
  isLoading: false,
  login: createMock(),
  logout: createMock(),
  refreshToken: createMock()
});</code></pre>

          <h3 id="data-fetching-hooks">Data Fetching Hooks</h3>

          <pre><code class="language-typescript">const mockUseApi = createMockHook('useApi', {
  data: null,
  loading: false,
  error: null,
  execute: createMock(),
  reset: createMock()
});</code></pre>

          <h3 id="router-hooks">Router Hooks</h3>

          <pre><code class="language-typescript">const mockUseRouter = createMockHook('useRouter', {
  pathname: '/test',
  query: {},
  push: createMock(),
  replace: createMock(),
  back: createMock()
});</code></pre>

          <h3 id="local-storage-hooks">Local Storage Hooks</h3>

          <pre><code class="language-typescript">const mockUseLocalStorage = createMockHook('useLocalStorage', {
  value: 'stored-value',
  setValue: createMock(),
  removeValue: createMock()
});</code></pre>

          <h2 id="troubleshooting">Troubleshooting</h2>

          <h3 id="hook-not-being-mocked">Hook Not Being Mocked</h3>

          <p>Ensure the module is mocked before importing the component:</p>

          <div class="callout callout-error">
            <pre><code class="language-typescript">// ❌ Import before mocking
import { MyComponent } from '@/components/MyComponent';

await mockModules.mock('@/hooks', () => ({
  useData: createMockHook('useData', mockData)
}));</code></pre>
          </div>

          <div class="callout callout-success">
            <pre><code class="language-typescript">// ✅ Mock before importing
await mockModules.mock('@/hooks', () => ({
  useData: createMockHook('useData', mockData)
}));

const { MyComponent } = await import('@/components/MyComponent');</code></pre>
          </div>

          <h3 id="typescript-errors">TypeScript Errors</h3>

          <p>
            Ensure your mock return value matches the hook's TypeScript
            interface:
          </p>

          <pre><code class="language-typescript">interface UserHookReturn {
  user: User | null;
  loading: boolean;
  error: string | null;
}

const mockUseUser = createMockHook&lt;UserHookReturn&gt;('useUser', {
  user: null,
  loading: false,
  error: null
});</code></pre>

          <div class="page-navigation">
            <a href="mock-utilities.html" class="nav-prev">Mock Utilities</a>
            <a href="component-mocking.html" class="nav-next"
              >Component Mocking</a
            >
          </div>

          <h2 id="see-also">See Also</h2>

          <ul>
            <li>
              <a href="module-mocking.html">Module Mocking</a> - For mocking
              entire modules
            </li>
            <li>
              <a href="component-mocking.html">Component Mocking</a> - For
              mocking React components
            </li>
            <li>
              <a href="mock-utilities.html">Mock Utilities</a> - Basic mock
              function utilities
            </li>
            <li>
              <a href="testing-patterns.html">Testing Patterns</a> - Advanced
              testing patterns
            </li>
          </ul>
        </div>
      </main>
    </div>

    <script src="js/gitbook.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
